<script>
    // SECURITY: Check if already logged in
    (function() {
        const adminUser = JSON.parse(sessionStorage.getItem('adminUser') || '{}');
        const isAdmin = sessionStorage.getItem('isAdmin');
        
        if (adminUser.username && isAdmin === 'true') {
            // Already logged in, redirect to dashboard
            window.location.href = 'admin-dashboard.html';
        }
    })();

    // Pre-configured admin accounts
    const adminAccounts = {
        'admin': {
            username: 'admin',
            password: 'Admin@123',
            name: 'System Administrator',
            role: 'superadmin',
            permissions: ['all'],
            lastLogin: null
        },
        'director': {
            username: 'director',
            password: 'Director@123',
            name: 'Daycare Director',
            role: 'director',
            permissions: ['view_all', 'manage_staff', 'manage_children', 'view_financials'],
            lastLogin: null
        },
        'staff': {
            username: 'staff',
            password: 'Staff@123',
            name: 'Daycare Staff',
            role: 'staff',
            permissions: ['view_children', 'update_records', 'upload_documents'],
            lastLogin: null
        }
    };

    // Save admin accounts to localStorage (for demo)
    if (!localStorage.getItem('adminAccounts')) {
        localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
    }

    document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const username = document.getElementById('adminUsername').value.trim();
        const password = document.getElementById('adminPassword').value;
        
        const storedAdmins = JSON.parse(localStorage.getItem('adminAccounts') || '{}');
        const adminAccount = storedAdmins[username];
        
        if (adminAccount && adminAccount.password === password) {
            // Update last login
            adminAccount.lastLogin = new Date().toISOString();
            storedAdmins[username] = adminAccount;
            localStorage.setItem('adminAccounts', JSON.stringify(storedAdmins));
            
            // Store session
            sessionStorage.setItem('adminUser', JSON.stringify(adminAccount));
            sessionStorage.setItem('isAdmin', 'true');
            
            // Redirect to admin dashboard
            window.location.href = 'admin-dashboard.html';
        } else {
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('adminPassword').value = '';
            
            // Log failed attempt
            console.warn(`Failed admin login attempt: ${username}`);
        }
    });

    // Auto-fill demo credentials for testing
    window.addEventListener('load', function() {
        const demoButton = document.createElement('button');
        demoButton.innerHTML = '<i class="fas fa-vial"></i> Use Demo Credentials';
        demoButton.type = 'button';
        demoButton.className = 'btn btn-secondary';
        demoButton.style.width = '100%';
        demoButton.style.marginTop = '10px';
        demoButton.style.padding = '12px';
        demoButton.onclick = function() {
            document.getElementById('adminUsername').value = 'admin';
            document.getElementById('adminPassword').value = 'Admin@123';
            alert('Demo credentials loaded:\nUsername: admin\nPassword: Admin@123\n\n⚠️ Change these in production!');
        };
        
        const form = document.getElementById('adminLoginForm');
        form.appendChild(demoButton);
    });
</script>
